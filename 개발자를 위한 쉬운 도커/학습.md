# 섹션 0 - 강의 준비

## 실행중인 컨테이너 모두 삭제 하는 방법

### 맥

`docker rm -f $(docker ps -aq)`

### 윈도우

powerShell

`docker ps -aq | ForEach-Object {docker rm -f $_}`

# 섹션 1 - 가상화 기술

## 파트 소개

도커 : 컨테이너 관리를 위한 SW

컨테이너 : 큰 서버를 효율적으로 나누어 사용하기 위한 가상화 기술

서버 - 가상화는 무엇??

Hypervisor vs Container

## 애플리케이션 서버

1. 베어메탈 : 컴퓨터를 구입하고 실행하는 방식(서버 구입 -> OS 설치 -> 소프트웨어 실행)

기업에서 사용하기 비효율적

2. 하이퍼바이저

3. 컨테이너

도커의 방식

## 가상 기술과 하이퍼바이저 가상화 기술

하이퍼바이저는 통역 역할

Guest -> Host 호출할 때 번역하는 역할

- 이 기종 커널 간 요청을 전달
- 가상머신 리소스 할당량 관리

VMware 또는 VirtualBox 등

Kernal이 분리되어 있다(Geust Kernal, Host Kernal)

## 컨테이너 가상화

하이퍼바이저 방식보다 더 선호된다

가볍고 빠르다

커널의 기능으로 자체 격리 환경 조성

LXC(LinuX Containers) 기술

모든 컨테이너는 Host Kernal을 공유한다

하이퍼바이저 방식보다 오버헤드가 더 적다(하드웨어 리소스 사용이 효율적, 속도가 빠름)

Kernal이 독립적인 가상 머신이 보안은 더 뛰어나다

컨테이너는 Host와 동일한 종류의 OS만 실행 가능하다

Docker는 이런 컨테이너를 쉽게 사용할 수 있도록 만들어준다

## Docker

Docker => 컨테이너 플랫폼

컨테이너 플랫폼 = 컨테이너 엔전 + 컨테이너 런타임

### 컨테이너 엔진

사용자 요청을 통해 컨테이너 관리

### 컨테이너 런타임

직접 커널과 통신, 격리된 공간 생성

Docker는 RunC라는 컨테이너 런타임 사용

OCI에서 제정한 CRI 표준 구현

### 아키텍처

클라이언트 - 서버 모델로 사용

클라이언트 -> Docker Deamon(컨테이너 관리)

Docker Deamon은 사용자에게 API 제공

Docker CLI를 통해 API 대신 명령어로 입력할 수 있음

## 컨테이너 실행

### 생성

`docker run -p 80:80 --name hellonginx nginx`

- docker run: 실행
- 80:80: 포트
- hellonginx: 컨테이너 이름
- nginx: 이미지

`Ctrl + c` 로 나올 수 있음

### 삭제

`docker rm hellonginx`

- docker rm : 삭제
- hellonginx : 컨테이너 이름

### 실행 순서도

1. docker run ... nginx

Clinet PC : Host OS

Docker CLI가 명령어를 컨테이너 실행 API로 맞게 만들어 `Docker Deamon`으로 전송

`Docker Deamon`은 요청 분석 후 컨테이너 런타임을 통해 컨테이너 생성

격리된 공간에서 안전한 운영 가능

# 이미지와 컨테이너

## 이미지와 컨테이너

`docker image ls`

이미지 목록 보기

`docker image ls ${name}`

name 이름을 가진 이미지 보기

Tag: 버전

Image Id: Image 고유 ID

한 개의 이미지에서 여러개의 컨테이너를 실행할 수 있다

동일한 이미지에서 실행된 컨테이너는 동일한 프로세스로 실행된다

이미지인 상태는 디스크 공간만 차지, 이미지를 컨테이너로 실행해야 CPU, MEMORY를 사용

- 프로세스와의 차이?: 컨테이너라는 격리된 공간이 생성된다

### 하나의 이미지에서 여러개의 컨테이너 실행

`docker run -d --name ${컨테이너 명} ${이미지 명}`

-d: 백그라운드에서 실행

`docker rm -f {컨테이너 명}`

실행중인 컨테이너는 -f 옵션으로 삭제

## 이미지의 메타데이터

`docker iamge inspect ${이미지 명}` 이미지 메타데이터 조회

`docker container inspect ${이미지 명}` 컨테이너 메타데이터 조회

`docker run ${이미지 명} (${실행 명령})` 컨테이너 실행 시 메타데이터 cmd 덮어 쓰기

`docker run --env KEY=VALUE ${이미지 명}` 컨테이너 실행 시 메타데이터 env 덮어쓰기
